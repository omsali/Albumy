{% extends 'base.html' %}

{% block title %}Upload{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dropzone.min.css') }}" type="text/css">
{{ dropzone.style('margin: 20px 0; border: 2px dashed #0087F7; min-height: 400px;') }}
{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Upload</h1>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Upload Photos</h5>
        <p class="card-text">Drag and drop images here or click to select files. You can optionally add a description for each photo.</p>
        
        <!-- Description field -->
        <div class="mb-3">
          <label for="description" class="form-label">Description (Optional)</label>
          <textarea class="form-control" id="description" name="description" rows="3" 
                    placeholder="Add a description for your photo... (Leave empty for auto-generated description)"></textarea>
          <div class="form-text">If you leave this empty, we'll automatically generate a description using AI.</div>
        </div>
        
        <!-- CSRF Token -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        {{ dropzone.create(action='main.upload') }}
      </div>
    </div>
    <a class="btn btn-light float-end" href="{{ url_for('user.index', username=current_user.username) }}">
      Done
    </a>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/dropzone.min.js') }}"></script>
<script>
Dropzone.options.dropzone = {
    paramName: "file",
    maxFilesize: 3,
    acceptedFiles: ".png,.jpg,.jpeg",
    addRemoveLinks: true,
    dictDefaultMessage: "Drop files here to upload",
    dictRemoveFile: "Remove",
    dictCancelUpload: "Cancel",
    init: function() {
        this.on("sending", function(file, xhr, formData) {
            // Add CSRF token
            if (window.csrfToken) {
                formData.append('csrf_token', window.csrfToken);
            }
            
            // Add description to form data
            var description = document.getElementById('description').value;
            if (description) {
                formData.append('description', description);
            }
        });
        
        this.on("success", function(file, response) {
            // Clear description field after successful upload
            document.getElementById('description').value = '';
        });
    }
};
</script>
{% endblock %}
